From 026c95efc8795cb1501a6d0778a3625c0111d164 Mon Sep 17 00:00:00 2001
From: Kartatz <105828205+Kartatz@users.noreply.github.com>
Date: Mon, 1 Dec 2025 16:46:22 -0300
Subject: [PATCH 3/3] Enable automatic linking of libhaiku

---
 gcc/config/haiku.opt | 4 ++++
 gcc/gcc.cc           | 5 ++++-
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/gcc/config/haiku.opt b/gcc/config/haiku.opt
index 5b22f3b44..752d8648e 100644
--- a/gcc/config/haiku.opt
+++ b/gcc/config/haiku.opt
@@ -29,4 +29,8 @@ Driver
 rdynamic
 Driver
 
+flink-libhaiku
+Target Var(flag_link_libhaiku) Init(1)
+Enable automatic linking of Haiku libraries that are part of the C standard library but require manual linking (-lbsd and -lnetwork).
+
 ; This comment is to ensure we retain the blank line above.
diff --git a/gcc/gcc.cc b/gcc/gcc.cc
index 282a52ca6..bbc99c89c 100644
--- a/gcc/gcc.cc
+++ b/gcc/gcc.cc
@@ -991,11 +991,14 @@ proper position among the other output files.  */
 #define LINK_LIBATOMIC_SPEC ""
 #endif
 
+#define LINK_LIBHAIKU_SPEC "%{!fno-link-libhaiku:" LD_AS_NEEDED_OPTION \
+			    " -lbsd -lgnu -lbnetapi -lnetwork " LD_NO_AS_NEEDED_OPTION "} "
+
 /* This is overridable by the target in case they need to specify the
    -lgcc and -lc order specially, yet not require them to override all
    of LINK_COMMAND_SPEC.  */
 #ifndef LINK_GCC_C_SEQUENCE_SPEC
-#define LINK_GCC_C_SEQUENCE_SPEC "%G %{!nolibc: " LINK_LIBATOMIC_SPEC "%L %G}"
+#define LINK_GCC_C_SEQUENCE_SPEC "%G %{!nolibc: " LINK_LIBATOMIC_SPEC " " LINK_LIBHAIKU_SPEC "%L %G}"
 #endif
 
 #ifndef LINK_SSP_SPEC
-- 
2.51.2

